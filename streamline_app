import streamlit as st
import pandas as pd
import sqlalchemy
from streamlit_autorefresh import st_autorefresh

# Use DB URL from Streamlit secrets when deployed
DB_URL = st.secrets.get("DATABASE_URL", "<LOCAL_URL_IF_YOU_WANT>")

engine = sqlalchemy.create_engine(DB_URL)

# Auto refresh
st_autorefresh(interval=60 * 1000, key="refresh")

def load_data():
    query = "SELECT * FROM ncd_bonds_latest_data WHERE xirr < 18"
    df = pd.read_sql(query, engine)
    return df

st.title("ðŸ“ˆ NCD Bonds Latest Data")

df = load_data()
st.dataframe(df, use_container_width=True)
